#include<bits/stdc++.h>
#define int long long
#define ll long long 
#define from return
#define yanyu289 0
using namespace std;
const int maxn = 2e5 + 10, mod = 998244353;
int n,a[maxn],cnt;
int used[maxn],pre[maxn],flag[maxn];
signed main(){
	ios::sync_with_stdio(false);
	cin.tie(0),cout.tie(0);
	cin >> n;
    for(int i = 1; i <= n; i ++) {
        cin>>a[i];
        if(!used[a[i]]) pre[i] = 1, used[a[i]] = 1;
    }
    for(int i = 1; i <= n; i ++) {
        if(a[i] < i || (a[i] != a[a[i]])) {
            cout<<0<<endl;
            return 0;
        }
    }
    memset(used,0,sizeof used);
    for(int i = n;i >= 0;i --)
		if(!used[a[i]]) flag[i] = 1, used[a[i]] = 1;
    int ans = 1;
    for(int i = 1; i <= n; i ++) {
        cnt += pre[i];
        if(flag[i]) ans = ans * cnt % mod, cnt --;
    }
    cout<<ans<<endl;
    from yanyu289;
}

/*


*/