#include <bits/stdc++.h>
#define int long long
using namespace std;
const int MOD = 998244353;
#ifdef int
#define inf 0x3f3f3f3f3f3f3f3f
#else
#define inf 0x3f3f3f3f
#endif
const long long infll = 0x3f3f3f3f3f3f3f3f;
#define pii pair<int, int>
#define mkp(x, y) make_pair(x, y)

#ifndef LOCAL
#define SUBMIT
#endif

#ifdef SUBMIT
#define endl '\n'
// #define cin Fastio ::cin
// #define cout Fastio ::cout
#endif

template <typename T>
void read(vector<T> &vec)
{
    for (auto &x : vec)
    {
        cin >> x;
    }
}

int qpow(int n, int k)
{
    int res = 1;
    while (k)
    {
        if (k & 1)
            (res *= n) %= MOD;
        (n *= n) %= MOD;
        k >>= 1;
    }
    return res;
}

vector<vector<int>> tuples = {
    {1, 1, 1, 1, 1},
    {1, 1, 1, 1, 2},
    {1, 1, 1, 1, 3},
    {1, 1, 1, 1, 4},
    {1, 1, 1, 2, 2},
    {1, 1, 1, 2, 3},
    {1, 1, 1, 2, 4},
    {1, 1, 1, 2, 5},
    {1, 1, 1, 3, 3},
    {1, 1, 1, 3, 4},
    {1, 1, 1, 3, 5},
    {1, 1, 1, 3, 6},
    {1, 1, 2, 2, 2},
    {1, 1, 2, 2, 3},
    {1, 1, 2, 2, 4},
    {1, 1, 2, 2, 5},
    {1, 1, 2, 2, 6},
    {1, 1, 2, 3, 3},
    {1, 1, 2, 3, 4},
    {1, 1, 2, 3, 5},
    {1, 1, 2, 3, 6},
    {1, 1, 2, 3, 7},
    {1, 1, 2, 4, 4},
    {1, 1, 2, 4, 5},
    {1, 1, 2, 4, 6},
    {1, 1, 2, 4, 7},
    {1, 1, 2, 4, 8},
    {1, 1, 3, 3, 4},
    {1, 1, 3, 3, 5},
    {1, 1, 3, 4, 5},
    {1, 1, 3, 4, 6},
    {1, 1, 3, 5, 6},
    {1, 1, 3, 5, 7},
    {1, 1, 4, 4, 6},
    {1, 1, 4, 5, 7},
    {1, 1, 4, 6, 8},
    {1, 2, 2, 2, 3},
    {1, 2, 2, 2, 5},
    {1, 2, 2, 3, 3},
    {1, 2, 2, 3, 4},
    {1, 2, 2, 3, 5},
    {1, 2, 2, 3, 6},
    {1, 2, 2, 3, 7},
    {1, 2, 2, 3, 8},
    {1, 2, 2, 4, 5},
    {1, 2, 2, 4, 7},
    {1, 2, 2, 5, 6},
    {1, 2, 2, 5, 8},
    {1, 2, 3, 3, 4},
    {1, 2, 3, 3, 5},
    {1, 2, 3, 3, 7},
    {1, 2, 3, 4, 4},
    {1, 2, 3, 4, 5},
    {1, 2, 3, 4, 6},
    {1, 2, 3, 4, 7},
    {1, 2, 3, 4, 8},
    {1, 2, 3, 4, 9},
    {1, 2, 3, 4, 10},
    {1, 2, 3, 5, 6},
    {1, 2, 3, 5, 7},
    {1, 2, 3, 5, 9},
    {1, 2, 3, 6, 7},
    {1, 2, 3, 6, 8},
    {1, 2, 3, 6, 10},
    {1, 2, 4, 4, 5},
    {1, 2, 4, 4, 7},
    {1, 2, 4, 5, 6},
    {1, 2, 4, 5, 7},
    {1, 2, 4, 5, 8},
    {1, 2, 4, 6, 7},
    {1, 2, 4, 6, 9},
    {1, 2, 4, 7, 8},
    {1, 2, 4, 7, 10},
    {1, 2, 5, 6, 8},
    {1, 2, 5, 6, 9},
    {1, 2, 6, 7, 10},
    {1, 3, 3, 4, 5},
    {1, 3, 3, 5, 7},
    {1, 3, 4, 4, 6},
    {1, 3, 4, 5, 6},
    {1, 3, 4, 5, 7},
    {1, 3, 4, 6, 8},
    {1, 3, 4, 7, 9},
    {1, 3, 4, 8, 10},
    {1, 3, 5, 6, 7},
    {1, 3, 5, 7, 9},
    {1, 3, 6, 8, 10},
    {1, 4, 5, 6, 8},
    {2, 2, 2, 3, 3},
    {2, 2, 3, 3, 4},
    {2, 2, 3, 4, 5},
    {2, 2, 3, 5, 6},
    {2, 2, 3, 6, 7},
    {2, 2, 3, 7, 8},
    {2, 3, 3, 4, 4},
    {2, 3, 3, 4, 5},
    {2, 3, 3, 4, 8},
    {2, 3, 4, 4, 5},
    {2, 3, 4, 5, 6},
    {2, 3, 4, 5, 8},
    {2, 3, 4, 6, 7},
    {2, 3, 4, 7, 8},
    {2, 3, 4, 8, 9},
    {2, 3, 4, 9, 10},
    {2, 3, 5, 6, 7},
    {2, 3, 6, 7, 8},
    {2, 4, 5, 6, 7},
    {2, 4, 5, 7, 8},
    {2, 5, 6, 8, 9},
    {3, 4, 4, 5, 6},
    {3, 4, 5, 6, 7},
    {3, 4, 5, 6, 8},
    {4, 5, 6, 7, 8}};

void work()
{
    int n;
    cin >> n;
    vector<vector<int>> vec(n, vector<int>(5));
    for (int i = 0; i < n; i++)
    {
        for (int j = 0; j < 5; j++)
        {
            cin >> vec[i][j];
        }
    }
    vector<int>p(n);
    read(p);
    int ans=inf;
    for(auto cd:tuples)
    {
        vector<pii>res;
        for(int i=0;i<n;i++)
        {
            int sum=0;
            for(int j=0;j<5;j++)
            {
                if(vec[i][j])sum+=cd[j];
            }
            res.push_back(mkp(-sum,p[i]-1));
        }
        // for(auto x:res)
        // {
        //     cout<<x.first<<' '<<x.second<<"!!!\n";
        // }
        // cout<<"???\n";
        sort(res.begin(),res.end());
        int tmp=0;
        for(int i=0;i<n;i++)
        {
            tmp+=(i-res[i].second)*(i-res[i].second);
        }
        ans=min(ans,tmp);
    }
    cout<<ans<<endl;
}

signed main()
{
#ifndef cin
#ifdef SUBMIT
    ios::sync_with_stdio(0);
    cin.tie(0);
#endif
#endif
    int t = 1;
    cin >> t;
    while (t--)
    {
        work();
    }
}