#include<bits/stdc++.h>
using namespace std;
const int N=5e5+5,mod=998244353;
typedef long long ll;
int n,m,a[N];map<int,int> ex;
ll fc[N],iv[N],tl,ans;
#define ck(x) ((tl=x)>=mod?tl-mod:tl)

ll inv(ll a){
	ll b=mod-2,c=1;while(b){
		if(b&1)c=c*a%mod;a=a*a%mod;b>>=1;
	}return c;
}

ll c(int x,int y){//cerr<<x<<" "<<y<<"\n";
	return (x>=0&&y>=0&&x>=y?fc[x]*iv[y]%mod*iv[x-y]%mod:0ll);
}

int main(){
	ios::sync_with_stdio(false);
	cin.tie(0); cout.tie(0); cin>>n;
	for(int i=1;i<=n;i++)cin>>a[i],ex[a[i]]++;
	m=ex.size();int x=0;
	for(int i=1;i<=n;i++)x+=a[i]!=a[i%n+1];x+=(x==0);
	if(x!=m){cout<<"0\n";return 0;}x=0;
	for(auto j:ex)if(j.second>2){x=1;break;}
	if(!x){cout<<(m==n?"1\n":"0\n");return 0;}
	fc[0]=1;for(int i=1;i<N;i++)fc[i]=fc[i-1]*i%mod;
	iv[N-1]=inv(fc[N-1]);for(int i=N-2;i>=0;i--)iv[i]=iv[i+1]*(i+1)%mod;
	if(m==n-2){
		if(n<=4)cout<<fc[n]<<"\n";
		else cout<<1ll*n*4*(n&1?m:m/2)%mod<<"\n";return 0;
	}m=n-m;ans=c(n,m);
	for(int i=1;i<=n;i++)
		ans=ck(ans-c(n-i-(m-1)*2-max(3-i,0),m-1)+mod);//cout<<ans<<"\n";
	cout<<ans*(n-m)%mod*fc[m]%mod<<"\n";
}